<?php
// Prevent direct access
if ($_SERVER["REQUEST_METHOD"] !== "POST") {
    http_response_code(405);
    exit("Method Not Allowed");
}

// Set response header
header('Content-Type: application/json');

// Your email address
$to_email = "abo650082@gmail.com";

// Get form data and sanitize
$firstName = isset($_POST['firstName']) ? htmlspecialchars(strip_tags($_POST['firstName'])) : '';
$lastName = isset($_POST['lastName']) ? htmlspecialchars(strip_tags($_POST['lastName'])) : '';
$email = isset($_POST['email']) ? filter_var($_POST['email'], FILTER_SANITIZE_EMAIL) : '';
$phone = isset($_POST['phone']) ? htmlspecialchars(strip_tags($_POST['phone'])) : '';
$message = isset($_POST['message']) ? htmlspecialchars(strip_tags($_POST['message'])) : '';
$humanAnswer = isset($_POST['humanAnswer']) ? intval($_POST['humanAnswer']) : 0;

// Validate required fields
if (empty($firstName) || empty($lastName) || empty($email) || empty($message)) {
    echo json_encode(['success' => false, 'message' => 'Missing required fields']);
    exit;
}

// Validate email
if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
    echo json_encode(['success' => false, 'message' => 'Invalid email address']);
    exit;
}

// Validate human check
if ($humanAnswer !== 9) {
    echo json_encode(['success' => false, 'message' => 'Human verification failed']);
    exit;
}

// Email subject
$subject = "New Contact Form Submission from VEXA Website";

// Email body
$email_body = "You have received a new message from the VEXA contact form.\n\n";
$email_body .= "Name: " . $firstName . " " . $lastName . "\n";
$email_body .= "Email: " . $email . "\n";
$email_body .= "Phone: " . ($phone ? $phone : "Not provided") . "\n\n";
$email_body .= "Message:\n" . $message . "\n";

// Email headers
$headers = "From: noreply@vexawebsite.com\r\n";
$headers .= "Reply-To: " . $email . "\r\n";
$headers .= "X-Mailer: PHP/" . phpversion();

// Send email
if (mail($to_email, $subject, $email_body, $headers)) {
    echo json_encode(['success' => true, 'message' => 'Message sent successfully']);
} else {
    echo json_encode(['success' => false, 'message' => 'Failed to send message']);
}
?>
